<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Exercise 19 - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" >
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Exercises</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Ex13/" class="dropdown-item">Exercise 13</a>
</li>
                                    
<li>
    <a href="../Ex14/" class="dropdown-item">Exercise 14</a>
</li>
                                    
<li>
    <a href="../Ex15/" class="dropdown-item">Exercise 15</a>
</li>
                                    
<li>
    <a href="../Ex16/" class="dropdown-item">Exercise 16</a>
</li>
                                    
<li>
    <a href="../Ex17/" class="dropdown-item">Exercise 17</a>
</li>
                                    
<li>
    <a href="../Ex18/" class="dropdown-item">Exercise 18</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Exercise 19</a>
</li>
                                    
<li>
    <a href="../Ex20/" class="dropdown-item">Exercise 20</a>
</li>
                                    
<li>
    <a href="../Ex28/" class="dropdown-item">Exercise 28</a>
</li>
                                    
<li>
    <a href="../Ex29/" class="dropdown-item">Exercise 28</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Test</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../test/test/" class="dropdown-item">Test</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Glossar</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../glossar/glos/" class="dropdown-item">Glos</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../Ex18/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Ex20/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="true">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#exercise-19" class="nav-link">Exercise 19</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#goal" class="nav-link">Goal</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#steps" class="nav-link">Steps</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="exercise-19">Exercise 19</h1>
<h2 id="goal">Goal</h2>
<p>This exercise is meant to teach us about partitions and mount procedures by <strong>adding a volume</strong> to the server, which is automounted at first. 
To get familiar with mounting and how it works, we have to <strong>create two partitions manually</strong> after starting up the server and observe what happens when we unmount them. Afterwards, we <strong>create specific mount points</strong> and <strong>mount the partitions manually</strong> to them. To ensure the <strong>mounting becomes permenant</strong>, it is required to happen automatically upon server reboot.</p>
<h2 id="steps">Steps</h2>
<h3 id="1-volume-creation">1. Volume creation</h3>
<ul>
<li>Extend the main.tf by adding a new rescource block, containing configuration for a volume with the size of 10 GB.</li>
<li>Enable automounting by setting the parameter automount to true and connect the volume to the server by using server_id. 
Without this server connection, the volume cannot be attached correctly, which makes this step essential for automounting. </li>
</ul>
<pre><code>resource &quot;hcloud_volume&quot; &quot;volume01&quot; {
  name      = &quot;volume1&quot;
  size      = 10
  server_id = hcloud_server.mainServer.id # !
  automount = true # !
  format    = &quot;xfs&quot;
}
</code></pre>
<ul>
<li>Now include an output directive to the output.tf file, returning information about the linux device of our volume. </li>
</ul>
<pre><code>output &quot;instance_volumeLinuxDevice&quot; {
    description = &quot;Linux device of volume&quot;
    value = hcloud_volume.volume01.linux_device
    }
</code></pre>
<ul>
<li>
<p>To check if it worked, start up the server, login and try the command <code>df</code>.
<strong>HIER BILD EINFÜGEN VON NOTIZEN</strong></p>
</li>
<li>
<p>Note: In this documentary, the specific volume-ID <code>HC_Volume_104253772</code> is used. When recreating the steps, the number can vary, depending on which specific volume in the storage pool the data is being read from or written to.</p>
</li>
<li>
<p>A known issue of automounting is that it does not work corrcetly if the server is rebooted, preventing the existing volume from being mounted to the recreated instance.
This problem orinates from the <code>run cmd</code> command in the cloud-template.yml and can be circumvented by adding the following line:
<code>udevadm trigger -c add -s block -p ID_VENDOR=HC --verbose -p ID_MODEL=Volume</code>.</p>
</li>
<li>
<p>This command would be executed by default, if it would not be overwritten by our own defined runmcd.</p>
</li>
<li>
<p>The volume is now available after rebooting. </p>
</li>
<li>
<p>Source: https://github.com/hetznercloud/terraform-provider-hcloud/issues/473#issuecomment-971535629-permalink </p>
</li>
</ul>
<h3 id="2-unmounting">2. Unmounting</h3>
<ul>
<li>After starting up the server and making sure the volume is set up corrcetly, use <code>cd /mnt/HC_Volume_104253772</code> to get to the diractionary where it is mounted. </li>
<li>When trying to unmount the volume by using <code>sudo umount</code>, an error pops up, telling us that the file is busy.</li>
<li>Work around that issue by going to a different diractionary and use <code>sudo umount /mnt/HC_Volume_104253772</code> again.</li>
<li>To test if the unmounting got executed correctly, we put some test.txt files into the folder. After unmounting successfully, the files disappear. </li>
<li>They reapear after mounting the volume again with the command <code>/dev/sdb/ /mnt/HC_Volume_104253772</code>. </li>
</ul>
<h3 id="3-creating-partitions">3. Creating partitions</h3>
<ul>
<li>The command for creating partitions manually is <code>fdisk /dev/sdb/</code>. </li>
<li>Create a new partition interactively:</li>
<li>Press n to add a new partition</li>
<li>Choose p to set the partition type to primary </li>
<li>Assign partition number 1</li>
<li>first sector is 2048 by default</li>
<li>set the last sector to half if the available volume space.</li>
</ul>
<p>Because the volume should be split into two partitions of approximately equal size (≈5 GB each),<br />
the end sector of the first partition is calculated as:</p>
<p>(last usable sector − first sector) / 2 + first sector</p>
<p>In our case the first partition spans from sector 2048 to 10484735.</p>
<ul>
<li>
<p>Press w to safe and exit.</p>
</li>
<li>
<p>To create the second partition, the same procedure is followed.
The second partition automatically starts at the next available sector and spans the remaining disk space, completing the split into two approximately equal partitions.</p>
</li>
<li>
<p>To change formating of the partitions, it is required to unmount the volume again. </p>
</li>
<li>Execute the command <code>mkfs -t ext4 /dev/sdb1</code>for creating an ext4 file system on your first partition.</li>
<li>Then use <code>mkfs -t xfs /dev/sdb2</code> for creating an xfs file system on your second partition. </li>
</ul>
<h3 id="4-manual-mounting">4. Manual mounting</h3>
<ul>
<li>To manually mount the previously created partitions, create two mountpoints "disk1" and disk2" by executing <code>mkdir /disk1 /disk2</code></li>
<li>Mount the first partition manually using the device name: <code>mount /dev/sdb1 /disk1</code>.</li>
<li>The second partition should be mounted by using its UUID. To get the UUID value, use <code>blkid /dev/sdb2</code>.</li>
<li>Mount the second partition with the following command: <code>mount UUID=&lt;uuid-of-sdb2&gt; /disk2</code>.</li>
</ul>
<h3 id="5-persistent-mounting">5. Persistent mounting</h3>
<ul>
<li>To ensure the mounts stay persistent upon rebooting, edit the /etc/fstab file by using the nano command.</li>
<li>Add the following content: <code>/dev/sdb1   /disk1   ext4   discard,nofail,defaults   0 2</code> and 
<code>UUID=&lt;uuid-of-sdb2&gt;  /disk2   xfs   discard,nofail,defaults   0 2</code></li>
<li>Instead of UUIDs, it is possible to assign labels to the partitions and use them for mounting. </li>
<li>The labels are assigned by using <code>e2label /dev/sdb1 part1</code>.</li>
<li>Do the same with sdb2 and label it with part2.</li>
<li>
<p>The /etc/fstab file now must contain the following lines: <code>LABEL=part1  /disk1  ext4  discard,nofail,defaults  0 2</code> and
<code>LABEL=part2  /disk2  xfs   discard,nofail,defaults  0 2</code>.</p>
</li>
<li>
<p>lik zum repository noch!!</p>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
